# 存储策略

数据网络上存储的是所有愿意将数据上传至数据网络的数据，这是开放性的，数据也是任意的。

因为是开放式存储，存储节点也是任意的个人或组织。所以逻辑上，这种存储是无限的。如此规模，每一个驿站节点肯定会有自己的存储选择，这就是存储策略。

目前，存储策略由三项措施来实现：**策略函数**、**白名单**、**黑名单**。


## 策略函数

策略函数是一个外部定义，由存储节点自己编写。驿站App会调用它，传递数据ID以及可能有的数据大小，如果函数返回真则表示愿意存储。

每一个数据类别都对应一个策略集（策略函数、黑名单和白名单），数据类别的值即为目录名（`0`、`1`……）。它们可能创建在用户的主目录内（`[Home]/.depots/ploys/` 下）。

策略函数的声明为：`func(id []byte, size int) bool`。

当前支持两种语言编写策略函数：Go、Lua。文件名默认为 `ploy.go`、`ploy.lua`。


## 白名单与黑名单

有一些数据可能是节点想无条件保留的，这就是白名单的逻辑。白名单的目标ID会用用户配置的随机种子与数据ID执行哈希混淆，因此名单中的ID并不是原始的数据ID，这是一种隐私保护（避免看到白名单的人了解你对哪些数据感兴趣）。

白名单中可包含单纯的目标ID，或与目标ID相匹配的正则表达式。

数据网络鼓励存储者无差别的随机存储，这对数据在全网的均衡分布有利。但肯定会有用户不希望存储某些东西，这就是黑名单的逻辑。ID规则与白名单类似（已混淆）。

在优先级上，白名单先于黑名单检查，如果某一目标ID同时存在于黑名单和白名单中，则白名单有效。其次，黑名单优于策略函数，如果某一目标已经存在于黑名单中，则不会再执行策略函数判断。

即优先级： *白名单 > 黑名单 > 策略函数*

> **提示：**
> 黑白名单采用 json 文件存储，通常来说仅适用于小规模。
> 如果你有大量的目标需要特别指定，采用策略函数+数据库的方式来管理会更好。


## 附：消息包攻击

如果一个攻击者虚构一个数据ID来发布询问，可能导致大量策略匹配的节点采取补存措施，这会导致该询问包的一次增量发布。

这可能是一个问题，如果有太多策略匹配的节点的话。但这仅限于一次增量，不会导致指数级增长的消息洪流。

> **应对措施：**
> 如果驿站节点因为紧缺性需要补存某个数据，可以并不急于执行，这可以降低消息包的突发性。
